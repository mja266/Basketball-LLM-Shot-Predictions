<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Basketball Play Predictor</title>
  <style>
    body {
      background-color: #111;
      color: white;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0;
      padding: 20px;
    }

    h1 {
      color: #ffcc00;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    select, input {
      width: 100%;
      padding: 10px;
      border-radius: 5px;
      border: none;
      margin: 5px 0;
      background-color: #222;
      color: white;
    }

    button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      background-color: #ffcc00;
      color: black;
      font-weight: bold;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover {
      background-color: #ffdd33;
    }

    .container {
      width: 400px;
      background: #181818;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 0 10px #000;
    }

    .result {
      margin-top: 15px;
      text-align: center;
      font-weight: bold;
    }

    .made {
      color: #4caf50;
    }

    .missed {
      color: #f44336;
    }

    .progress-bar {
      height: 10px;
      border-radius: 5px;
      margin-top: 10px;
    }

    .progress-fill {
      height: 10px;
      border-radius: 5px;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>üèÄ Basketball Play Predictor</h1>

    <label>Team</label>
    <select id="team"></select>

    <label>Player</label>
    <select id="player"></select>

    <label>Period (1‚Äì4)</label>
    <input type="number" id="period" min="1" max="4" value="4" />

    <label>Time remaining (mm:ss)</label>
    <input type="text" id="time" value="2:00" />

    <label>Shot type</label>
    <select id="shotType">
      <option>2PT Field Goal</option>
      <option>3PT Field Goal</option>
    </select>

    <label>X coordinate (0‚Äì50)</label>
    <input type="number" id="x" min="0" max="50" value="25" />

    <label>Y coordinate (0‚Äì50)</label>
    <input type="number" id="y" min="0" max="50" value="25" />

    <button onclick="predict()">Predict</button>

    <div id="result" class="result"></div>
    <div id="progress" class="progress-bar">
      <div id="fill" class="progress-fill"></div>
    </div>
  </div>

  <script>
    const apiBase = "http://127.0.0.1:5000";

    async function loadTeams() {
      try {
        const res = await fetch(`${apiBase}/teams`);
        const teams = await res.json();
        const teamSelect = document.getElementById("team");
        teamSelect.innerHTML = teams.map(team => `<option value="${team}">${team}</option>`).join("");
        loadPlayers(teams[0]);
      } catch (err) {
        console.error("Error loading teams:", err);
      }
    }

    async function loadPlayers(team) {
      try {
        const res = await fetch(`${apiBase}/players/${encodeURIComponent(team)}`);
        const players = await res.json();
        const playerSelect = document.getElementById("player");
        playerSelect.innerHTML = players.map(p => `<option value="${p}">${p}</option>`).join("");
      } catch (err) {
        console.error("Error loading players:", err);
      }
    }

    document.getElementById("team").addEventListener("change", (e) => {
      loadPlayers(e.target.value);
    });

    async function predict() {
      const payload = {
        team_id: document.getElementById("team").value,
        player_name: document.getElementById("player").value,
        period: document.getElementById("period").value,
        pctimestring: document.getElementById("time").value,
        shot_type: document.getElementById("shotType").value,
        x: document.getElementById("x").value,
        y: document.getElementById("y").value
      };

      const resultDiv = document.getElementById("result");
      const fill = document.getElementById("fill");
      resultDiv.innerHTML = "‚è≥ Predicting...";

      try {
        const res = await fetch(`${apiBase}/predict`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        const data = await res.json();

        if (!data.ok) throw new Error(data.error);

        const prob = (data.made_probability * 100).toFixed(1);
        const label = data.prediction_label;
        const color = label === "MADE" ? "#4caf50" : "#f44336";

        resultDiv.innerHTML = `üèÄ Shot <span class="${label === "MADE" ? "made" : "missed"}">${label}</span> (${prob}% chance)`;
        fill.style.width = `${prob}%`;
        fill.style.backgroundColor = color;
      } catch (err) {
        console.error("Prediction failed:", err);
        resultDiv.innerHTML = `<span class="missed">‚ùå ${err.message}</span>`;
      }
    }

    window.onload = loadTeams;
  </script>
</body>
</html>
